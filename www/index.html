<html>
  <meta charset="UTF-8">
  <head>
    <script type="text/javascript" src="js/cbimain.js"></script>
    <script type="text/javascript" src="js/cbihelper.js"></script>
    <script type="text/javascript" src="js/cbiparser.js"></script>
  </head>
  <body style="background-color: lightsteelblue">
    <div style="text-align: center">
      <div>
        Web Interface for interacting with the <br>
        <i><script type="text/javascript">document.write(cbiGetVersion(true));</script></i><br>
        by <b>Krevo_ </b><br><br>

        <canvas id="canvas1" width="508" height="252"></canvas>
        <canvas id="canvas2" width="508" height="252"></canvas>
       <br>
	     <button onclick="swap();">G <-> T</button>
	     <button style="display: none;" onclick="clignoteCurseurGraphOn();">Clignote</button>
       <br><br>
        <textarea id="srcCode" cols="80" rows="15">
        </textarea>
        <textarea style="display: none" id="srcCode0">
""
""
""
"    Hello World !"
        </textarea>
        <textarea style="display: none" id="srcCode1">
5->A
Lbl 1
A
Dsz A
Goto 1
"      Ignition !"
        </textarea>
        <textarea style="display: none" id="srcCode2">
Range 1,10,0,10,1,0
Mcl:1->A:1->B
Lbl 1
Plot 1,A:Plot B,10:Line
Isz A:Isz B:A<>11=>Goto 1
Mcl:1->A:10->B
Lbl 2
Plot A,10:Plot 10,B:Line
Isz A:Dsz B:Goto 2
Mcl:10->A:10->B
Lbl 3
Plot A,1:Plot 10,B:Line
Dsz A:Dsz B:Goto 3
Mcl:10->A:1->B
Lbl 4
Plot A,1:Plot 1,B:Line
Isz B:Dsz A:Goto 4
Cls:Mcl:Goto 1
        </textarea>
        <textarea style="display: none" id="srcCode3">
-500->A
Lbl 1
Range 1,127,0,1,63,0
Plot Ran#*127, Ran#*63
Isz A
Goto 1        
        </textarea>
        <textarea style="display: none" id="srcCode4">
Range 1,127,0,63,1,0
0->B
Lbl 1
0->A
Lbl 2
Int (Ran#*2)->C
Plot A*5,(B+C)*5
Plot (A+1)*5,(B+1-C)*5
Line
Isz A
A<26=>Goto 2
Isz B
B<14=>Goto 1       
       </textarea>
        <textarea style="display: none" id="srcCode5">
50->A
Lbl 1
Ran#
Dsz A
Goto 1
       </textarea>
        <textarea style="display: none" id="srcCode6">
"   CALCUL IMC"
"Poids (kg) "?->P
"Taille (m) "?->T
Int(P/(T*T)*100)/100
       </textarea>
        <textarea style="display: none" id="srcCode7">
# ---------------------
# CALENDRIER UNIVERSEL
# ---------------------

Prog 1

@@ Prog 1 ( )

Range 1,127,0,1,63,0 
Plot 76,8
Plot 76,55:Line
7->E
Lbl 4
Plot 10*E-4,8
Plot 10*E-4,55:Line
Plot 6,8*E-1
Plot 76,8*E-1:Line
Dsz E
Goto 4
7->E:0->C
Prog 7
"CALENDRIER UNIVERSEL"
Lbl 1
"ANNEE "?->Y
"MOIS "?->N
1->D
N<>Int (N)=>Goto 1
Y<>Int (Y)=>Goto 1
D<>Int (D)=>Goto 1
Int((14-N)/12)->C
Y-C->A
N+12*C-2->M
D+A+Int(A/4)-Int(A/100)+Int(A/400)+Int((31*M)/12)->J
J-Int(J/7)*7->P
P=0=>7->P
30->J
(N/2)<>Int (N/2)=>N<=7=>31->J
(N/2)=Int (N/2)=>N>=8=>31->J     
N=2=>28->J
N=2=>Frac(Y/4)=0=>Frac(Y/100)>0=>29->J
N=2=>Frac(Y/400)=0=>29->J
1->N
Lbl 5
N+P-1->O
Int ((O-1)/7)+2->E
O-(E-2)*7->D
8-E->E:Prog F
Int (N/10)->C
C<>0=>Prog G
C=0=>A+4->A
Frac (N/10)*10->C
Prog G
Isz N
N<=J=>Goto 5

@@ Prog 7 ( )

Text 3,10,"L"
Text 3,18,"M"
Text 3,28,"M"
Text 3,39,"J"
Text 3,49,"V"
Text 3,59,"S"
Text 3,69,"D"

@@ Prog F ( )

(D-1)*10+8-1->A
E*8+5->B

@@ Prog G ( )

Text 64-B,A,C
A+4->A
       </textarea>
        <textarea style="display: none" id="srcCode8">
# 
# CITY 
# 1 ou 2 Joueurs
# 
# VOUS ETES LE PERSONNAGE DE GAUCHE SUR L' ECRAN GRAPHIQUE. VOTRE BUT : TUER
# AVEC UN TIR DE MORTIER BIEN PLACE VOTRE ENNEMIE DE TOUJOURS 
# POUR CELA, VOUS DEVEZ INDIQUEZ L'ANGLE (EN DEGRE), PUIS LA FORCE DE TIR (ENTRE 50 ET 100 ENVIRON).
# --------------------

Prog 1

@@ Prog 1 ( ) 

Range 4,645,0,400,4,0
Deg
Mcl
10->D
Lbl 0
Int(Ran#*230)+170->E[D]
Dsz D
Goto 0
Prog 9
2->S:101->T:Prog 8
9->S:548->T:Prog 8
0->R
Lbl 5
"JOUEURS 1 2 "?->E
E<>1=>E<>2=>Goto 5
1->P
Plot X,Y
Lbl 1
P=1=>0.15->Q
P=2=>-0.15->Q
Plot X,Y:Line
Isz Z
"ANGLE "?->U
P=2=>-U->U
"FORCE "?->V
V*cos U->S
V*sin U->T
0->C
Lbl 2
C+Q->C
S*C+.5*R*C*C->A
P=1=>101+A->A
P=2=>548+A->A
E[7*P-5]+(.5*9.81*C*C)-50-T*C->B
Plot A,B
Int ((A-5)/64)+1->D
P=1=>A>533=>A<563=>B<E[D]=>B>E[D]-58=>Goto 4
P=2=>A>90=>A<111=>B<E[D]=>B>E[D]-58=>Goto 4
B<E[D]=>D>0=>D<11=>Goto 2
E=2=>3-P->P
Goto 1
Lbl 4
9->S:548->T
P=2=>2->S
P=2=>101->T
Prog Y
Plot X,Y:Line
"GAGNE"
E=1=>"PTS"
E=2=>"GAGNANT:"
E=1=>240-40*Z
E=2=>P
""

@@ Prog 8 ( ) 

16->D
Plot T-D,E[S]
Plot T,E[S]-25
Line
Plot T+D,E[S]
Line
Plot T-D,E[S]-32
Plot T+D,E[S]-32
Line
Plot T,E[S]-45
Plot T,E[S]-25
Line
Plot T,E[S]-45
Plot T-(D/3),Y
Line
Plot X,E[S]-58
Line
Plot T+(D/3),Y
Line
Plot X,E[S]-45
Line
Plot T,E[S]-45
Line

@@ Prog 9 ( ) 

Cls
0->D
Lbl 1
Isz D
64*(D-1)+5->W
Plot W,400
Plot W,E[D]
Line
Plot W+64,E[D]
Line
Plot W+64,400
Line
D<10=>Goto 1

@@ Prog Y ( )

Deg
-180->A
Lbl 1
Rec(45,A)
I+T->X
J+E[S]->Y
Plot X,Y
Plot T,E[S]
Line
15+A->A
A<=0=>Goto 1
       </textarea>
        <textarea style="display: none" id="srcCode9">
#
# POLYGONE REGULIER
#
Deg
Mcl
Range 1,127,0,1,63,0
" POLYGON "
"NB COTE "?->N
360/N->A
Plot 94,32
0->K
Lbl 1
K+A->K
Rec(30,K)
Plot I+64,J+32
Line
K<360=>Goto 1
       </textarea>
        <textarea style="display: none" id="srcCode10">
"Hello !"
"Have a break ?"◢
"Bye."
       </textarea>
        <br>
        <button onclick="executeCode();">Execute !</button>
        <button onclick="stopCodeExecution()">STOP !</button>
        <br>
        <br>
 List of <a href="availablefunctions.html">currently implemented functions</a><br><br>
 Sample programs :<br><br>
        <button onclick="loadProg(0);">Hello World !</button>  
        <button onclick="loadProg(1);">5,4,3,...</button>  
        <button onclick="loadProg(2);">Screen saver</button>  
        <button onclick="loadProg(3);">Random dots</button>  
        <button onclick="loadProg(5);">Random num</button>
        <br>
        <button onclick="loadProg(4);">Maze generator</button>
        <button onclick="loadProg(6);">IMC</button>
        <button onclick="loadProg(7);">Calendrier</button>
        <button onclick="loadProg(8);">City</button>  
        <button onclick="loadProg(9);">Polygon</button>
        <button onclick="loadProg(10);">Hello ◢</button>   <br><br>
      </div>
    </div>
    <script type="text/javascript">

      function loadProg(progNumber) {
        stopCodeExecution();
        var srcCode = document.getElementById("srcCode"+progNumber).value;
        document.getElementById("srcCode").value = srcCode;
        executeCode();
      }

      function executeCode() {
        var srcCode = document.getElementById("srcCode").value;
        document.getElementById("srcCode").disabled = true;
        if (idTimerMain == 0) {
          jsccRun(srcCode);
        }
      }

      function stopCodeExecution() {
        finish("SIG_STOP received !");
      }

      var casioScreenW = 127;
      var casioScreenH = 63;

      var c1 = document.getElementById("canvas1");
      var c2 = document.getElementById("canvas2");

      var ctx1=c1.getContext("2d");
      var ctx2=c2.getContext("2d");

      var c=c1;
      var ctx=ctx1;

      /* Test */
      if (window.addEventListener){
        window.addEventListener("keypress", calcHandleOnKeyPress, false);
        window.addEventListener("keydown", calcHandleOnKeyDown, false);  
      } else if (window.attachEvent){ // IE sucks !
        window.attachEvent("keypress", calcHandleOnKeyPress, false);
        window.attachEvent("keydown", calcHandleOnKeyDown, false);
      }
      

      var zoomW = c.width  / casioScreenW;
      var zoomH = c.height / casioScreenH;
      console.log("zoomW = "+zoomW+" zoomH = "+zoomH);
      var dx = -1;
      var dy = -1;
      console.log("dx = "+dx+" dy = "+dy);

      function prepareDisplay(ctx) {
        // No anti-aliasing
        ctx.imageSmoothingEnabled = false
        ctx.webkitImageSmoothingEnabled = false
        ctx.mozImageSmoothingEnabled = false
   
        // We need to keep a var (called 'gtm') containing the current transformation applied to canvas (until ctx.currentTransform is fully supported)
        // that's why we avoid using ctx.scale() or ctx.translate();
        var svgElement = document.createElementNS("http://www.w3.org/2000/svg", "svg");
        gtm = svgElement.createSVGMatrix();
        gtm = gtm.scaleNonUniform(zoomW,zoomH); // Apply zoom
        gtm = gtm.translate(dx,dy); // Translate so coords starts from (1,1) and go to (127,63);
        ctx.transform(gtm.a, gtm.b, gtm.c, gtm.d, gtm.e, gtm.f); // Apply transform to canvas
      }

      prepareDisplay(ctx1);
      prepareDisplay(ctx2);

      // Efface ecran texte 
      clrtext();

      // Efface ecran graphique
      cls();
      

      loadProg(0);
      //executeCode();
    </script>
    <div style="text-align: right">
      <a href="https://twitter.com/Krevo_" class="twitter-follow-button" data-show-count="false">Follow @Krevo_</a>
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
    </div>

  </body>
</html>
